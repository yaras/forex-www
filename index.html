<html>
	<head>
		<title>chart</title>

		<script type="text/javascript" src="jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="knockout-3.1.0.js"></script>
		<script type="text/javascript" src="candles.js"></script>
		<script type="text/javascript" src="chartViewModel.js"></script>
		<script type="text/javascript" src="candleViewModel.js"></script>

		<style type="text/css">
			.chart {
				border: 1px solid;
			}

			.drawing {
				cursor: crosshair;
			}
		</style>

		<script type="text/javascript">
			var chartViewModel = '';

			$(function() {
				chartViewModel = new ChartViewModel('.chart');
				ko.applyBindings(chartViewModel);
				chartViewModel.addCandles(candles);
			});
		</script>
	</head>

	<body>
		
		<table>
			<tr>
				<td>
					<div class="chart" style="height: 500px; width: 850px" data-bind="css: { 'drawing': mode() != 'none' }">
						<svg>
							<rect style="fill: gray" width="800" height="1" x="0" data-bind="attr: { y: cursorY }"></rect>
							<rect style="fill: gray" width="1" height="500" y="0" data-bind="attr: { x: cursorX }"></rect>

							<!-- ko foreach: verticalAxe -->
								<rect style="fill: #ddd" x="0" height="1" width="800" data-bind="attr: { y: y }"></rect>
								<g data-bind="attr: { transform: transform }">
									<text style="font-size: 9pt" data-bind="text: value"></text>
								</g>
							<!-- /ko -->

							<!-- ko foreach: horizontalAxe -->
								<rect style="fill: #ddd" y="0" height="500" width="1" data-bind="attr: { x: x }"></rect>
								<g data-bind="attr: { transform: transform }">
									<text style="font-size: 9pt" data-bind="text: date"></text>
								</g>
							<!-- /ko -->

							<!-- ko foreach: chartIndicators -->
								<polyline style="fill:none; stroke: red; stroke-width:1" data-bind="attr: {points: points}"></polyline>
							<!-- /ko -->

							<!-- ko foreach: candles -->					
								<g data-bind="event: { mouseover: setSelected, mouseout: setUnselected }">
									<rect style="fill: none" data-bind="attr: { style: candleStyle, x: shadowX() - 4, height: shadowHeight, width: 10, y: shadowY }"></rect>

									<rect style="fill: black" width="1" data-bind="{attr: { x: shadowX, y: shadowY, height: shadowHeight }}"></rect>

									<rect width="6" data-bind="{attr: { style: bodyStyle, x: bodyX, y: bodyY, height: bodyHeight }}"></rect>
								</g>
							<!-- /ko -->

							<!-- ko foreach: helperRects -->
								<rect fill="rgba(255, 255, 0, 0.7)" data-bind="attr: { x: x, y: y, height: height, width: width }"></rect>
							<!-- /ko -->

							<!-- ko foreach: helperLines -->
								<line style="stroke:rgba(0, 0, 0, 0.7); stroke-width:1" data-bind="attr: { x1: x1, y1: y1, x2: x2, y2: y2 }"></line>
							<!-- /ko -->

							<!-- ko if: mode() == 'rect-stop' -->
								<rect fill="rgba(255, 255, 0, 0.8)" data-bind="attr: { x: drawFirstX, y: drawFirstY, height: drawHeight, width: drawWidth }"></rect>
							<!-- /ko -->

							<!-- ko if: mode() == 'line-stop' -->
								<line style="stroke:rgba(0,0,0, 0.8);stroke-width:1" data-bind="attr: { x1: drawFirstX, y1: drawFirstY, x2: drawSecondX, y2: drawSecondY }"></line>
							<!-- /ko -->
						</svg>
					</div>	
				</td>

				<td>
					<div data-bind="if: selected">
						date: <span data-bind="text: selected().date"></span>
						<br />
						open: <span data-bind="text: selected().open"></span>
						<br />
						high: <span data-bind="text: selected().high"></span>
						<br />
						low: <span data-bind="text: selected().low"></span>
						<br />
						close: <span data-bind="text: selected().close"></span>
					</div>

					<br />
					value: <span data-bind="text: cursorValue()"></span>
				</td>
			</tr>
		</table>

		<button data-bind="click: drawRect">Draw rect</button>
		<button data-bind="click: drawLine">Draw line</button>
	</body>
</html>